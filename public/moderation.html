<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ—Ç–æ–≤</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        background: #f8f9fa;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
      }
      th,
      td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: left;
      }
      th {
        background: #00aaff;
        color: white;
      }
      img {
        max-width: 80px;
        max-height: 80px;
        border-radius: 6px;
      }
      button {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 6px;
      }
      .approve-btn {
        background: #28a745;
        color: white;
      }
      .confirm-btn {
        background: #007bff;
        color: white;
      }
      .delete-btn {
        background: #dc3545;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>üõ† –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ—Ç–æ–≤</h1>
    <table id="mod-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–§–æ—Ç–æ</th>
          <th>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      async function loadCats() {
        const res = await fetch("/all-cats");
        const cats = await res.json();
        const tbody = document.querySelector("#mod-table tbody");

        cats.forEach((cat) => {
          // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω—É–∂–Ω–æ –æ–¥–æ–±—Ä–∏—Ç—å
          if (!cat.approved || !cat.confirmed) {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${cat.id}</td>
              <td>${cat.description || "‚Äî"}</td>
              <td>${cat.photo_url ? `<img src="${cat.photo_url}" />` : ""}</td>
              <td>${
                cat.confirm_photo_url
                  ? `<img src="${cat.confirm_photo_url}" />`
                  : ""
              }</td>
              <td>${cat.status}</td>
              <td>
                ${
                  !cat.approved
                    ? `<button class="approve-btn" onclick="moderate(${cat.id}, 'approve')">–û–¥–æ–±—Ä–∏—Ç—å</button>`
                    : ""
                }
                ${
                  cat.confirm_photo_url && !cat.confirmed
                    ? `<button class="confirm-btn" onclick="moderate(${cat.id}, 'confirm')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–µ–µ–∑–¥</button>`
                    : ""
                }
                <button class="delete-btn"
                        onclick="if (confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å?')) moderate(${
                          cat.id
                        }, 'delete')">
                  –£–¥–∞–ª–∏—Ç—å
                </button>
              </td>
            `;
            tbody.appendChild(row);
          }
        });
      }

      async function moderate(id, action) {
        const res = await fetch(`/moderate?id=${id}&action=${action}`);
        if (res.ok) {
          alert("–ì–æ—Ç–æ–≤–æ!");
          location.reload();
        } else {
          const text = await res.text();
          alert("–û—à–∏–±–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏: " + text);
        }
      }

      loadCats();
    </script>
  </body>
</html>
